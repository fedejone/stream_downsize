# stream_downsize

 Основной идеей исполнения модуля, так же как и в апсайзере является указатель, но его логика будет иной. На этот раз данные из распакованного массива будут преобразованы в один вектор значений и будут выдаваться на выход последовательно, в зависимости от значения указателя.
 ![](/doc/pointer.jpg)

Для этого был нужен простой счетчик и флаг сброса этого счетчика.
- Флаг сброса является флагом переполнения указателя, когда указатель заполняется, это значит что все данные из предыдущей транзакции выданы и можно читать новые 
#
 Так как интерфейс модуля является урезанной шиной axi-stream, у него присутствует **рукопожатие valid и ready**.
- Для корректной записи данных, нужен флаг записи, активный **только тогда, когда со слейва активен валид** и сам модуль готов принимать данные.
- Выходной **valid** будет выставлен только тогда, когда модуль считал данные и может выдавать их последовательно.
- выходной ***ready***  будет выставлен только в том случае, если указатель свободен и готов принимать новые данные  
#
Для увеличения пропускной способности на вход модуля можно поставить Fifo, как это было реализовано в модуле ***stream_upsizer*** , оно бы так же увеличило latency модуля на 1, но и позволило бы развязать ***valid-ready*** между модулем и слейвом. 

## Построчное  комментирования модуля ***stream_downsize***
- 32 - флаг записи данных
- 33 - флаг чтения данных 
- 34 - флаг конца указателя (активен при флаге чтения для защиты от сброса указателя при непрочитанных данных)
- 36 -  выходной валид. Активен при наличии данных в обработке
- 37 - выходные данные. Выдаются в зависимости от указателя, как представлено на рисунке выше  
- 39 - выходное реди - активно при отсутствии данных в обработке
- 42-49 - логика указателя (простой счетчик со сбросом)
- 52-59 - логика регистра full_bank  ( 1 - когда данные выдаются мастеру. 0 - когда данных на выдачу нет и можно принимать новые)
- 62-70 - Преобразование из нескольких входных векторов данных в один (как показано на рисунке выше)
- 73-79 - регистр сигнала ***last***  записывает значение сигнала, в момент записи данных
#
- Код проекта находится в папке *RTL*

- Тестбенч модуля находится в папке *tb*

- Скрипт для запуска симуляции проекта находится в папке *sim\modelsim\stream_downsize\make_sim.bat*

- Скрипт для запуска синтеза проекта находится в папке  *syn\Vivado\make_analyz.bat*